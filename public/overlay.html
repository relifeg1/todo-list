<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>HUD Overlay AR</title>
    <link href="https://fonts.googleapis.com/css2?family=Changa:wght@500;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Changa', sans-serif; 
            margin: 0; padding: 25px; 
            background-color: transparent; 
            overflow: hidden; 
            color: white;
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* محاذاة لليمين تلقائياً بسبب dir=rtl */
        }

        .hud-wrapper {
            width: 450px;
            /* خط التجميع على اليمين ليناسب العربية */
            border-right: 3px solid rgba(255, 255, 255, 0.15);
            padding-right: 20px; 
        }

        /* --- العناوين (Headers) --- */
        .section-title {
            font-size: 16px;
            margin-bottom: 8px;
            margin-top: 20px;
            opacity: 0.9;
            font-weight: 800; /* وزن ثقيل للعنوان */
            display: flex;
            align-items: center;
        }

        /* تنسيق العنوان الرئيسي */
        .title-main { 
            color: #ff9800; 
            text-shadow: 0 0 15px rgba(255, 152, 0, 0.5); 
        }
        
        /* تنسيق العنوان الجانبي */
        .title-side { 
            color: #00bcd4; 
            text-shadow: 0 0 15px rgba(0, 188, 212, 0.5); 
            margin-top: 30px; 
        }

        ul { list-style: none; padding: 0; margin: 0; }

        /* --- عناصر القائمة --- */
        li {
            display: flex;
            align-items: center;
            justify-content: flex-start; /* ترتيب العناصر من اليمين */
            margin-bottom: 5px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }

        /* أيقونة المهمة (الماسية) */
        .marker {
            margin-left: 12px; /* مسافة بين الأيقونة والنص */
            font-size: 14px;
            line-height: 0;
            transition: all 0.3s;
        }

        /* تنسيق نص المهمة الرئيسية */
        .task-main {
            font-size: 26px; /* خط كبير وواضح للعربي */
            font-weight: 700;
            color: #fff;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.8); /* ظل قوي لضمان القراءة */
            line-height: 1.4;
        }
        .task-main .marker { color: #ff9800; font-size: 18px; }

        /* تنسيق نص المهمة الثانوية */
        .task-side {
            font-size: 20px;
            font-weight: 500;
            color: #e0e0e0;
            padding-right: 10px; /* إزاحة بسيطة للداخل */
        }
        .task-side .marker { color: #00bcd4; }

        /* --- حالة الانتهاء --- */
        li.done { opacity: 0.5; filter: grayscale(100%); }
        li.done span.text { text-decoration: line-through; }
        
        /* تحول الأيقونة عند الانتهاء */
        li.done .marker { color: #4CAF50 !important; transform: scale(1.2); }

        /* أنميشن الدخول (Glitch Effect بسيط) */
        @keyframes scan-enter {
            0% { opacity: 0; transform: translateX(20px); }
            100% { opacity: 1; transform: translateX(0); }
        }
        .new-entry { animation: scan-enter 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

    </style>
</head>
<body>

<div class="hud-wrapper">
    <div id="main-section" style="display:none;">
        <div class="section-title title-main">/// العمليات الرئيسية</div>
        <ul id="main-list"></ul>
    </div>

    <div id="side-section" style="display:none;">
        <div class="section-title title-side">/// أهداف ثانوية</div>
        <ul id="side-list"></ul>
    </div>
</div>

<script>
    const API_URL = "/api/data";
    let currentTasks = [];

    async function fetchData() {
        try {
            const res = await fetch(API_URL);
            const newTasks = await res.json();
            if(Array.isArray(newTasks)) updateList(newTasks);
        } catch(e) { console.error(e); }
    }

    function updateList(newTasks) {
        const mainList = document.getElementById('main-list');
        const sideList = document.getElementById('side-list');
        const mainSection = document.getElementById('main-section');
        const sideSection = document.getElementById('side-section');

        mainList.innerHTML = '';
        sideList.innerHTML = '';
        
        let hasMain = false;
        let hasSide = false;

        newTasks.forEach(task => {
            const isSide = task.type === 'side';
            const li = document.createElement('li');
            li.id = `task-${task.id}`;
            li.className = isSide ? 'task-side' : 'task-main';
            if (task.done) li.classList.add('done');
            
            const oldTask = currentTasks.find(t => t.id === task.id);
            if (!oldTask) li.classList.add('new-entry');

            li.onclick = () => toggleTaskStatus(task);

            // الرمز الماسي
            const markerChar = isSide ? '◇' : '◆'; 

            // ترتيب العناصر: الرمز أولاً ثم النص (بسبب RTL سيظهر الرمز يمين النص)
            li.innerHTML = `
                <span class="marker">${markerChar}</span>
                <span class="text">${task.text}</span>
            `;

            if (isSide) {
                sideList.appendChild(li);
                hasSide = true;
            } else {
                mainList.appendChild(li);
                hasMain = true;
            }
        });

        mainSection.style.display = hasMain ? 'block' : 'none';
        sideSection.style.display = hasSide ? 'block' : 'none';

        currentTasks = newTasks;
    }

    async function toggleTaskStatus(task) {
        task.done = !task.done;
        const idx = currentTasks.findIndex(t => t.id === task.id);
        if(idx > -1) currentTasks[idx] = task;
        
        try {
            await fetch(API_URL, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(currentTasks)
            });
            updateList([...currentTasks]);
        } catch(e) { console.error(e); }
    }

    setInterval(fetchData, 2000);
    fetchData();
</script>

</body>
</html>