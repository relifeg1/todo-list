<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>OBS Overlay</title>
    <style>
        /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø´ÙØ§ÙØ© */
        body { 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; padding: 20px; 
            background-color: transparent; 
            overflow: hidden; 
        }

        .todo-container {
            width: 350px; /* Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ø¨Ø« */
            background: rgba(18, 18, 18, 0.85); /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© Ù†ØµÙ Ø´ÙØ§ÙØ© */
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.6);
            border-right: 6px solid #4CAF50; /* Ø®Ø· Ø£Ø®Ø¶Ø± Ø¬Ù…Ø§Ù„ÙŠ ÙŠÙ…ÙŠÙ† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
            backdrop-filter: blur(5px); /* ØªØ£Ø«ÙŠØ± Ø¶Ø¨Ø§Ø¨ÙŠ Ù„Ù„Ø®Ù„ÙÙŠØ© */
        }

        h2 { 
            margin: 0 0 15px 0; 
            color: #fff; 
            font-size: 22px; 
            font-weight: 800;
            text-transform: uppercase; 
            border-bottom: 2px solid #333; 
            padding-bottom: 10px; 
            text-align: right;
            letter-spacing: 1px;
        }

        ul { list-style: none; padding: 0; margin: 0; }
        
        li {
            background: rgba(255, 255, 255, 0.08);
            color: white;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Ø­Ø±ÙƒØ© Ù†Ø§Ø¹Ù…Ø© */
            border: 1px solid transparent;
        }

        /* --- Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø£Ù†Ù…ÙŠØ´Ù† --- */

        /* 1. Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ */
        li.done {
            background: rgba(76, 175, 80, 0.1);
            text-decoration: line-through;
            color: #888;
            border-color: #4CAF50;
            opacity: 0.8;
            transform: scale(0.98);
        }

        /* Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØµØ­ */
        li.done::after {
            content: 'âœ”';
            color: #4CAF50;
            font-size: 1.2em;
            font-weight: bold;
        }

        /* 2. Ø£Ù†Ù…ÙŠØ´Ù† Ù„Ø­Ø¸Ø© Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (ÙˆÙ…ÙŠØ¶) */
        @keyframes flash-success {
            0% { background-color: #fff; color: #000; transform: scale(1.1); }
            50% { background-color: #4CAF50; color: #fff; transform: scale(1.05); }
            100% { background-color: rgba(76, 175, 80, 0.1); color: #888; transform: scale(0.98); }
        }

        .just-completed {
            animation: flash-success 0.8s ease-out forwards;
        }

        /* 3. Ø£Ù†Ù…ÙŠØ´Ù† Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯ */
        @keyframes slide-in {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .new-task-anim {
            animation: slide-in 0.4s ease-out forwards;
        }

    </style>
</head>
<body>

<div class="todo-container">
    <h2>ğŸ¯ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
    <ul id="list"></ul>
</div>

<script>
    // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„Ø³ÙŠØ±ÙØ±
    const API_URL = "/api/data";
    
    let currentTasks = [];

    // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    async function fetchData() {
        try {
            const res = await fetch(API_URL);
            const newTasks = await res.json();
            if(Array.isArray(newTasks)) {
                updateList(newTasks);
            }
        } catch(e) { console.error("Error fetching data:", e); }
    }

    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ù„Ø£Ù†Ù…ÙŠØ´Ù†
    function updateList(newTasks) {
        const list = document.getElementById('list');
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        newTasks.forEach(newTask => {
            const oldTask = currentTasks.find(t => t.id === newTask.id);
            let el = document.getElementById(`task-${newTask.id}`);
            
            // 1. Ø¥Ø°Ø§ Ø§Ù„Ù…Ù‡Ù…Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ Ø£Ù†Ø´Ø¦Ù‡Ø§
            if (!el) {
                el = document.createElement('li');
                el.id = `task-${newTask.id}`;
                el.innerText = newTask.text;
                el.classList.add('new-task-anim'); // Ø£Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„
                list.appendChild(el);
            } else {
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ Ù„Ùˆ ØªØºÙŠØ±
                if(el.childNodes[0].nodeValue !== newTask.text) {
                     el.innerText = newTask.text; 
                }
            }

            // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ÙˆØ§Ù„Ø£Ù†Ù…ÙŠØ´Ù†
            if (newTask.done) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ù‡Ù…Ø© ØºÙŠØ± Ù…Ù†ØªÙ‡ÙŠØ© Ø³Ø§Ø¨Ù‚Ø§Ù‹ ÙˆØ£ØµØ¨Ø­Øª Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„Ø¢Ù†
                if (!oldTask || !oldTask.done) {
                    el.classList.add('just-completed');
                    setTimeout(() => el.classList.remove('just-completed'), 1000);
                }
                // Ø¶Ù…Ø§Ù† ÙˆØ¬ÙˆØ¯ ÙƒÙ„Ø§Ø³ done
                el.classList.add('done');
            } else {
                el.classList.remove('done');
            }
        });

        // 3. Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙŠ ØªÙ… Ù…Ø³Ø­Ù‡Ø§ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù†
        currentTasks.forEach(oldTask => {
            if (!newTasks.find(t => t.id === oldTask.id)) {
                const el = document.getElementById(`task-${oldTask.id}`);
                if(el) {
                    el.style.opacity = '0'; // Ø¥Ø®ÙØ§Ø¡ ØªØ¯Ø±ÙŠØ¬ÙŠ
                    setTimeout(() => el.remove(), 400);
                }
            }
        });

        currentTasks = newTasks;
    }

    // Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø«Ø§Ù†ÙŠØªÙŠÙ†
    setInterval(fetchData, 2000);
    
    // ØªØ´ØºÙŠÙ„ ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
    fetchData();
</script>

</body>
</html>