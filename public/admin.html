<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZAIRU - nPoint Control</title>
    <link href="https://fonts.googleapis.com/css2?family=Changa:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --accent: #ff9800; --text: #eee; --danger: #f44336; --success: #4CAF50; }
        * { box-sizing: border-box; }
        body { font-family: 'Changa', sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; justify-content: center; min-height: 100vh; margin:0; }
        .container { width: 100%; max-width: 900px; display: flex; flex-direction: column; gap: 20px; }
        .card { background: var(--card); border: 1px solid #333; border-radius: 12px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .game-bar { display: flex; gap: 15px; align-items: center; background: #151515; border-bottom: 2px solid var(--accent); }
        select, input, button { padding: 10px; border-radius: 8px; border: 1px solid #444; background: #2a2a2a; color: white; font-family: 'Changa'; outline: none; }
        button { cursor: pointer; font-weight: bold; }
        .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .toggles-area { grid-column: span 2; display: flex; flex-wrap: wrap; gap: 10px; background: #181818; padding: 10px; border-radius: 8px; }
        .save-btn { grid-column: span 2; background: var(--success); border: none; padding: 12px; }
        
        /* Input Area */
        .input-area { border-bottom: 4px solid var(--accent); background: #252525; }
        .row { display: flex; gap: 10px; margin-bottom: 10px; }
        #taskInput { flex-grow: 1; }
        .main-btn { flex-grow: 1; background: var(--accent); color: black; border: none; font-size: 1.1em; }
        
        /* Task List */
        ul { list-style: none; padding: 0; display: flex; flex-direction: column; gap: 10px; }
        li { background: #222; padding: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; }
        .task-info { display: flex; gap: 10px; align-items: center; }
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 0.8em; font-weight: bold; background: #333; border: 1px solid #555; }
        .b-lvl { color: #ffeb3b; } .b-main { color: #ff9800; } .b-side { color: #00bcd4; }
        .actions { display: flex; gap: 5px; }
        .act-btn { width: 35px; height: 35px; border-radius: 6px; border: none; font-size: 1.2em; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        .btn-done { background: var(--success); } .btn-fail { background: var(--danger); } .btn-del { background: #444; }
        
        li.done { opacity: 0.6; border-right: 4px solid var(--success); }
        li.done .task-text { text-decoration: line-through; color: #888; }
        li.failed { opacity: 0.8; border-right: 4px solid var(--danger); }
        li.failed .task-text { text-decoration: line-through; color: var(--danger); }
        
        #statusMsg { text-align: center; color: #666; font-size: 0.9em; }
    </style>
</head>
<body>
<div class="container">
    <div class="card game-bar">
        <span style="color:var(--accent); font-weight:bold;">üéÆ ÿßŸÑŸÑÿπÿ®ÿ©:</span>
        <select id="gameSelector" style="flex-grow:1;" onchange="switchGame()"><option value="">-- ÿ™ÿ≠ŸÖŸäŸÑ --</option></select>
        <button onclick="createNewGame()" style="background:#2196F3; border:none;">+</button>
        <button onclick="deleteGame()" style="background:var(--danger); border:none;">üóëÔ∏è</button>
    </div>

    <div class="card">
        <div class="settings-grid">
            <input type="number" id="visibleDur" placeholder="ŸÖÿØÿ© ÿßŸÑÿ∏ŸáŸàÿ± (ÿ´ŸàÿßŸÜŸä)">
            <input type="number" id="hiddenDur" placeholder="ŸÖÿØÿ© ÿßŸÑÿßÿÆÿ™ŸÅÿßÿ° (ÿ´ŸàÿßŸÜŸä)">
            <select id="visMode"><option value="auto">ÿ™ŸÑŸÇÿßÿ¶Ÿä</option><option value="always">ÿØÿßÿ¶ŸÖ</option></select>
            <div class="toggles-area">
                <label><input type="checkbox" id="autoLevelToggle"> Auto Level</label>
                <label><input type="checkbox" id="hideXPToggle"> Hide XP</label>
                <label><input type="checkbox" id="hideLevelToggle"> Hide Level</label>
                <label><input type="checkbox" id="particlesToggle"> Particles</label>
                <label><input type="checkbox" id="glitchToggle"> Glitch</label>
                <label><input type="checkbox" id="aarToggle"> Show Report (AAR)</label>
            </div>
            <button class="save-btn" onclick="saveSettings()">üíæ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</button>
        </div>
    </div>

    <div class="card input-area">
        <div class="row">
            <select id="taskType" style="width:120px;"><option value="main">ÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</option><option value="side">ÿ¨ÿßŸÜÿ®Ÿäÿ©</option></select>
            <input type="number" id="taskLevelInput" value="1" style="width:60px; text-align:center;">
            <input type="text" id="taskInput" placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÖŸáŸÖÿ©..." onkeypress="if(event.key==='Enter') submitTask()">
        </div>
        <div class="row">
            <button class="main-btn" onclick="submitTask()">ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸáŸÖÿ©</button>
            <label style="display:flex; align-items:center; gap:5px; background:#333; padding:0 10px; border-radius:8px;">
                <input type="checkbox" id="timerCheck"> ŸÖÿ§ŸÇÿ™ ‚è±Ô∏è
            </label>
        </div>
    </div>

    <ul id="taskList"></ul>
    <div id="statusMsg">Ready (nPoint)</div>
</div>

<script>
    // ‚úÖ ÿ±ÿßÿ®ÿ∑ nPoint ÿßŸÑÿ¨ÿØŸäÿØ
    const API_URL = "https://api.npoint.io/9ff5d39f969a4b4840ba";

    let dataStore = { tasks: [], settings: { currentLevel: 1, activeGame: "Default" }, presets: {} };

    async function loadData() {
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            dataStore = { ...dataStore, ...data };
            if(!dataStore.tasks) dataStore.tasks = [];
            if(!dataStore.presets) dataStore.presets = {};
            updateUI(); updateGameList(); render();
        } catch(e) { console.error(e); document.getElementById('statusMsg').innerText = "Connection Error"; }
    }

    async function syncData() {
        document.getElementById('statusMsg').innerText = "Saving...";
        try {
            await fetch(API_URL, {
                method: 'PUT', // nPoint uses PUT to update
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dataStore)
            });
            document.getElementById('statusMsg').innerText = "Saved ‚úÖ";
        } catch(e) { document.getElementById('statusMsg').innerText = "Save Failed ‚ùå"; }
    }

    function render() {
        const list = document.getElementById('taskList'); list.innerHTML = "";
        const sorted = [...dataStore.tasks].sort((a,b) => a.level - b.level);
        sorted.forEach((task, idx) => {
            const realIdx = dataStore.tasks.findIndex(t => t.id === task.id);
            const li = document.createElement('li');
            if(task.done) li.classList.add('done');
            if(task.failed) li.classList.add('failed');
            if(task.level != dataStore.settings.currentLevel) li.style.opacity = "0.5";
            
            const badgeType = task.type === 'side' ? 'b-side' : 'b-main';
            li.innerHTML = `
                <div class="task-info">
                    <span class="badge b-lvl">L${task.level}</span>
                    <span class="badge ${badgeType}">${task.type}</span>
                    <span class="task-text">${task.text} ${task.hasTimer ? '‚è±Ô∏è' : ''}</span>
                </div>
                <div class="actions">
                    <button class="act-btn btn-done" onclick="toggle(${realIdx}, 'done')">‚úî</button>
                    <button class="act-btn btn-fail" onclick="toggle(${realIdx}, 'fail')">‚ò†Ô∏è</button>
                    <button class="act-btn btn-del" onclick="del(${realIdx})">‚úï</button>
                </div>`;
            list.appendChild(li);
        });
    }

    function submitTask() {
        const text = document.getElementById('taskInput').value;
        if(!text) return;
        dataStore.tasks.push({
            id: Date.now(), text, type: document.getElementById('taskType').value,
            level: parseInt(document.getElementById('taskLevelInput').value),
            hasTimer: document.getElementById('timerCheck').checked,
            timerStart: document.getElementById('timerCheck').checked ? Date.now() : null,
            done: false, failed: false
        });
        document.getElementById('taskInput').value = "";
        savePreset(); syncData(); render();
    }

    function toggle(idx, type) {
        if(type === 'done') { dataStore.tasks[idx].done = !dataStore.tasks[idx].done; dataStore.tasks[idx].failed = false; }
        if(type === 'fail') { dataStore.tasks[idx].failed = !dataStore.tasks[idx].failed; dataStore.tasks[idx].done = false; }
        if((dataStore.tasks[idx].done || dataStore.tasks[idx].failed) && dataStore.tasks[idx].hasTimer) dataStore.tasks[idx].timerEnd = Date.now();
        syncData(); render();
    }

    function del(idx) { if(confirm("ÿ≠ÿ∞ŸÅÿü")) { dataStore.tasks.splice(idx,1); savePreset(); syncData(); render(); } }

    function updateUI() {
        const s = dataStore.settings;
        document.getElementById('visibleDur').value = s.visibleDuration || 15;
        document.getElementById('hiddenDur').value = s.hiddenDuration || 300;
        document.getElementById('visMode').value = s.visibilityMode || 'auto';
        document.getElementById('autoLevelToggle').checked = s.autoLevelUp;
        document.getElementById('hideXPToggle').checked = s.hideXP;
        document.getElementById('hideLevelToggle').checked = s.hideLevel;
        document.getElementById('particlesToggle').checked = s.enableParticles;
        document.getElementById('glitchToggle').checked = s.enableGlitch;
        document.getElementById('aarToggle').checked = s.showAAR;
        document.getElementById('taskLevelInput').value = s.currentLevel || 1;
    }

    function saveSettings() {
        dataStore.settings = { ...dataStore.settings,
            visibleDuration: parseInt(document.getElementById('visibleDur').value),
            hiddenDuration: parseInt(document.getElementById('hiddenDur').value),
            visibilityMode: document.getElementById('visMode').value,
            autoLevelUp: document.getElementById('autoLevelToggle').checked,
            hideXP: document.getElementById('hideXPToggle').checked,
            hideLevel: document.getElementById('hideLevelToggle').checked,
            enableParticles: document.getElementById('particlesToggle').checked,
            enableGlitch: document.getElementById('glitchToggle').checked,
            showAAR: document.getElementById('aarToggle').checked
        };
        syncData();
    }

    function updateGameList() {
        const sel = document.getElementById('gameSelector');
        sel.innerHTML = '<option value="">-- ÿ™ÿ≠ŸÖŸäŸÑ --</option>';
        const games = new Set(["Default"]);
        Object.keys(dataStore.presets).forEach(k => games.add(k.split('_')[0]));
        games.forEach(g => {
            const opt = document.createElement('option'); opt.value = g; opt.innerText = g;
            if(g === dataStore.settings.activeGame) opt.selected = true;
            sel.appendChild(opt);
        });
    }

    function createNewGame() {
        const name = prompt("ÿßÿ≥ŸÖ ÿßŸÑŸÑÿπÿ®ÿ©:"); if(!name) return;
        savePreset(); dataStore.settings.activeGame = name; dataStore.settings.currentLevel = 1; dataStore.tasks = [];
        syncData(); render(); updateGameList();
    }
    
    function switchGame() {
        const g = document.getElementById('gameSelector').value; if(!g) return;
        savePreset();
        dataStore.settings.activeGame = g; dataStore.settings.currentLevel = 1;
        const key = `${g}_1`;
        dataStore.tasks = dataStore.presets[key] || [];
        syncData(); render();
    }

    function deleteGame() {
        const g = dataStore.settings.activeGame;
        if(g === 'Default') return alert("ŸÑÿß ŸäŸÖŸÉŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä");
        if(confirm(`ÿ≠ÿ∞ŸÅ ${g}ÿü`)) {
            Object.keys(dataStore.presets).forEach(k => { if(k.startsWith(g)) delete dataStore.presets[k]; });
            dataStore.settings.activeGame = "Default"; dataStore.tasks = [];
            syncData(); render(); updateGameList();
        }
    }

    function savePreset() {
        const key = `${dataStore.settings.activeGame || 'Default'}_${dataStore.settings.currentLevel || 1}`;
        dataStore.presets[key] = dataStore.tasks;
    }

    loadData();
</script>
</body>
</html>