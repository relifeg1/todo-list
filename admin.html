<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>تحكم Todo List</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; }
        input, button { padding: 10px; border-radius: 5px; border: none; margin-bottom: 10px; }
        input[type="text"] { width: 70%; background: #333; color: white; }
        button#addBtn { width: 25%; background: #4CAF50; color: white; cursor: pointer; }
        
        ul { list-style: none; padding: 0; }
        li { background: #2d2d2d; padding: 10px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; border-radius: 5px; cursor: grab; }
        li.done { text-decoration: line-through; opacity: 0.6; }
        
        .actions button { margin-left: 5px; cursor: pointer; padding: 5px 10px; }
        .delete-btn { background: #f44336; color: white; }
        .check-btn { background: #2196F3; color: white; }
        
        .status { font-size: 0.8em; color: #888; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>لوحة التحكم (Admin)</h2>
    
    <div>
        <input type="text" id="newTask" placeholder="أدخل هدف جديد...">
        <button id="addBtn" onclick="addTask()">إضافة</button>
    </div>

    <ul id="taskList"></ul>
    <div id="statusMsg" class="status">جاري الاتصال...</div>
</div>

<script>
    // تم إضافة رابطك هنا مباشرة
    const API_URL = "https://jsonblob.com/api/jsonBlob/019bdbe5-a54f-705f-a70a-0e7e478b35ef";
    
    let tasks = [];

    async function loadData() {
        try {
            const res = await fetch(API_URL);
            tasks = await res.json();
            // تأكد أن البيانات مصفوفة
            if (!Array.isArray(tasks)) tasks = [];
            render();
            document.getElementById('statusMsg').innerText = "تم التحميل بنجاح";
        } catch(e) { 
            console.log("Error loading", e);
            document.getElementById('statusMsg').innerText = "خطأ في التحميل، تأكد من الإنترنت";
        }
    }

    function render() {
        const list = document.getElementById('taskList');
        list.innerHTML = "";
        tasks.forEach((task, index) => {
            const li = document.createElement('li');
            li.className = task.done ? 'done' : '';
            li.innerHTML = `
                <span>${task.text}</span>
                <div class="actions">
                    <button class="check-btn" onclick="toggleTask(${index})">✓</button>
                    <button class="delete-btn" onclick="deleteTask(${index})">X</button>
                </div>
            `;
            list.appendChild(li);
        });
    }

    function addTask() {
        const input = document.getElementById('newTask');
        if (!input.value) return;
        tasks.push({ text: input.value, done: false, id: Date.now() });
        input.value = "";
        render();
        syncData();
    }

    function deleteTask(index) {
        tasks.splice(index, 1);
        render();
        syncData();
    }

    function toggleTask(index) {
        tasks[index].done = !tasks[index].done;
        render();
        syncData();
    }

    async function syncData() {
        document.getElementById('statusMsg').innerText = "جاري الحفظ...";
        await fetch(API_URL, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(tasks)
        });
        document.getElementById('statusMsg').innerText = "تم الحفظ وتحديث البث!";
    }

    // تشغيل التحميل عند فتح الصفحة
    loadData();
</script>
</body>
</html>